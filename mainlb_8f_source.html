<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>L-BFGS-B: src/mainlb.f Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">L-BFGS-B
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">Large-scale Bound-constrained Optimization</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('mainlb_8f_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mainlb.f</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mainlb_8f.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">c&gt; \file mainlb.f</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">c&gt; \brief This subroutine solves bound constrained optimization problems by</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">c&gt;        using the compact formula of the limited memory BFGS updates.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">c&gt; This subroutine solves bound constrained optimization problems by</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">c&gt; using the compact formula of the limited memory BFGS updates.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">c&gt;   </span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">c&gt; @param n On entry n is the number of variables.&lt;br/&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">c&gt;          On exit n is unchanged.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">c&gt; @param m On entry m is the maximum number of variable metric</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">c&gt;             corrections allowed in the limited memory matrix.&lt;br/&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">c&gt;          On exit m is unchanged.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">c&gt; @param x On entry x is an approximation to the solution.&lt;br/&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">c&gt;          On exit x is the current approximation.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">c&gt; @param l On entry l is the lower bound of x.&lt;br/&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">c&gt;          On exit l is unchanged.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">c&gt; @param u On entry u is the upper bound of x.&lt;br/&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">c&gt;          On exit u is unchanged.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">c&gt; @param nbd On entry nbd represents the type of bounds imposed on the</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">c&gt;               variables, and must be specified as follows:</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">c&gt;               nbd(i)=&lt;ul&gt;&lt;li&gt;0 if x(i) is unbounded,&lt;/li&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">c&gt;                          &lt;li&gt;1 if x(i) has only a lower bound,&lt;/li&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">c&gt;                          &lt;li&gt;2 if x(i) has both lower and upper bounds,&lt;/li&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">c&gt;                          &lt;li&gt;3 if x(i) has only an upper bound.&lt;/li&gt;&lt;/ul&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">c&gt;            On exit nbd is unchanged.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">c&gt; @param f On first entry f is unspecified.&lt;br/&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">c&gt;          On final exit f is the value of the function at x.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">c&gt; @param g On first entry g is unspecified.&lt;br/&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">c&gt;          On final exit g is the value of the gradient at x.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">c&gt; @param factr On entry factr &gt;= 0 is specified by the user.  The iteration</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">c&gt;                 will stop when&lt;br/&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">c&gt;                        (f^k - f^{k+1})/max{|f^k|,|f^{k+1}|,1} &lt;= factr*epsmch&lt;br/&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">c&gt;                 where epsmch is the machine precision, which is automatically</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">c&gt;                 generated by the code.&lt;br/&gt;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">c&gt;              On exit factr is unchanged.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">c&gt; @param pgtol On entry pgtol &gt;= 0 is specified by the user.  The iteration</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">c&gt;                 will stop when&lt;br/&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">c&gt;                        max{|proj g_i | i = 1, ..., n} &lt;= pgtol&lt;br/&gt;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">c&gt;                 where pg_i is the ith component of the projected gradient.&lt;br/&gt;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">c&gt;              On exit pgtol is unchanged.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">c&gt; </span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">c&gt; @param ws On entry this stores S, a set of s-vectors, that defines the</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">c&gt;              limited memory BFGS matrix.&lt;br/&gt;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">c&gt;           On exit this array is unchanged.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">c&gt; @param wy On entry this stores Y, a set of y-vectors, that defines the</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">c&gt;              limited memory BFGS matrix.&lt;br/&gt;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">c&gt;           On exit this array is unchanged.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">c&gt; @param sy On entry this stores S&#39;Y, that defines the</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">c&gt;              limited memory BFGS matrix.&lt;br/&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">c&gt;           On exit this array is unchanged.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">c&gt; @param ss On entry this stores S&#39;S, that defines the</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">c&gt;              limited memory BFGS matrix.&lt;br/&gt;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">c&gt;           On exit this array is unchanged.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">c&gt; @param wt On entry this stores the</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">c&gt;              Cholesky factorization of (theta*S&#39;S+LD^(-1)L&#39;), that defines the</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">c&gt;              limited memory BFGS matrix. See eq. (2.26) in [3].&lt;br/&gt;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">c&gt;           On exit this array is unchanged.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">c&gt; @param wn working array used to store the LEL^T factorization of the indefinite matrix</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">c&gt;                     K = [-D -Y&#39;ZZ&#39;Y/theta     L_a&#39;-R_z&#39;  ]</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">c&gt;                         [L_a -R_z           theta*S&#39;AA&#39;S ]&lt;br/&gt;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">c&gt;           where     E = [-I  0]</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">c&gt;                         [ 0  I]</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">c&gt; @param snd working array used to store the lower triangular part of</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">c&gt;                      N = [Y&#39; ZZ&#39;Y   L_a&#39;+R_z&#39;]</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">c&gt;                          [L_a +R_z  S&#39;AA&#39;S   ]</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">c&gt;                 </span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">c&gt; @param z working array used at different times to store the Cauchy point and</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">c&gt;          the Newton point.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">c&gt; @param r working array</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">c&gt; @param d working array</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">c&gt; @param t working array</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">c&gt; @param xp working array used to safeguard the projected Newton direction</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">c&gt; @param wa working array</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">c&gt; @param index In subroutine freev, index is used to store the free and fixed</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">c&gt;              variables at the Generalized Cauchy Point (GCP).</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">c&gt; @param iwhere working array used to record</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">c&gt;               the status of the vector x for GCP computation.&lt;br/&gt;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">c&gt;               iwhere(i)=&lt;ul&gt;&lt;li&gt;0 or -3 if x(i) is free and has bounds,&lt;/li&gt;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">c&gt;                             &lt;li&gt; 1       if x(i) is fixed at l(i), and l(i) .ne. u(i)&lt;/li&gt;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">c&gt;                             &lt;li&gt; 2       if x(i) is fixed at u(i), and u(i) .ne. l(i)&lt;/li&gt;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">c&gt;                             &lt;li&gt; 3       if x(i) is always fixed, i.e.,  u(i)=x(i)=l(i)&lt;/li&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">c&gt;                             &lt;li&gt;-1       if x(i) is always free, i.e., no bounds on it.&lt;/li&gt;&lt;/ul&gt;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">c&gt; @param indx2 working array&lt;br/&gt;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">c&gt;              Within subroutine cauchy, indx2 corresponds to the array iorder.&lt;br/&gt;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">c&gt;              In subroutine freev, a list of variables entering and leaving</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">c&gt;              the free set is stored in indx2, and it is passed on to</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">c&gt;              subroutine formk with this information.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">c&gt; @param task working string indicating</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">c&gt;             the current job when entering and leaving this subroutine.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">c&gt; @param iprint It controls the frequency and type of output generated:&lt;ul&gt;</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">c&gt;               &lt;li&gt;iprint&lt;0    no output is generated;&lt;/li&gt;</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">c&gt;               &lt;li&gt;iprint=0    print only one line at the last iteration;&lt;/li&gt;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">c&gt;               &lt;li&gt;0&lt;iprint&lt;99 print also f and |proj g| every iprint iterations;&lt;/li&gt;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">c&gt;               &lt;li&gt;iprint=99   print details of every iteration except n-vectors;&lt;/li&gt;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">c&gt;               &lt;li&gt;iprint=100  print also the changes of active set and final x;&lt;/li&gt;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">c&gt;               &lt;li&gt;iprint&gt;100  print details of every iteration including x and g;&lt;/li&gt;&lt;/ul&gt;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">c&gt;               When iprint &gt; 0, the file iterate.dat will be created to</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">c&gt;                                summarize the iteration.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">c&gt; @param csave working string</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">c&gt; @param lsave working array</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">c&gt; @param isave working array</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">c&gt;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">c&gt; @param dsave working array</span></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="mainlb_8f.html#a5a0132dc055b1aade2710adfff9b8f09">  128</a></span>&#160;      <span class="keyword">subroutine </span><a class="code" href="mainlb_8f.html#a5a0132dc055b1aade2710adfff9b8f09">mainlb</a>(n, m, x, l, u, nbd, f, g, factr, pgtol, ws, wy,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;     +                  sy, ss, wt, wn, snd, z, r, d, t, xp, wa, </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;     +                  index, iwhere, indx2, task,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;     +                  iprint, csave, lsave, isave, dsave)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordtype">character*60</span>     task, csave</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordtype">logical</span>          lsave(4)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordtype">integer</span>          n, m, iprint, nbd(n), index(n),</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;     +                 iwhere(n), indx2(n), isave(23)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordtype">double precision</span> f, factr, pgtol,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;     +                 x(n), l(n), u(n), g(n), z(n), r(n), d(n), t(n), </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">c-jlm-jn</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;     +                 xp(n), </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;     +                 wa(8*m), </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;     +                 ws(n, m), wy(n, m), sy(m, m), ss(m, m), </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;     +                 wt(m, m), wn(2*m, 2*m), snd(2*m, 2*m), dsave(29)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">c     References:</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">c       [1] R. H. Byrd, P. Lu, J. Nocedal and C. Zhu, ``A limited</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">c       memory algorithm for bound constrained optimization&#39;&#39;,</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">c       SIAM J. Scientific Computing 16 (1995), no. 5, pp. 1190--1208.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">c       [2] C. Zhu, R.H. Byrd, P. Lu, J. Nocedal, ``L-BFGS-B: FORTRAN</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">c       Subroutines for Large Scale Bound Constrained Optimization&#39;&#39;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">c       Tech. Report, NAM-11, EECS Department, Northwestern University,</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">c       1994.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">c </span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">c       [3] R. Byrd, J. Nocedal and R. Schnabel &quot;Representations of</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">c       Quasi-Newton Matrices and their use in Limited Memory Methods&#39;&#39;,</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">c       Mathematical Programming 63 (1994), no. 4, pp. 129-156.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">c       (Postscript files of these papers are available via anonymous</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">c        ftp to eecs.nwu.edu in the directory pub/lbfgs/lbfgs_bcm.)</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">c                           *  *  *</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">c     NEOS, November 1994. (Latest revision June 1996.)</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">c     Optimization Technology Center.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">c     Argonne National Laboratory and Northwestern University.</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">c     Written by</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">c                        Ciyou Zhu</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">c     in collaboration with R.H. Byrd, P. Lu-Chen and J. Nocedal.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">c     ************</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordtype">logical</span>          prjctd,cnstnd,boxed,updatd,wrk</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordtype">character*3</span>      word</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordtype">integer</span>          i,k,nintol,itfile,iback,nskip,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;     +                 head,col,iter,itail,iupdat,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;     +                 nseg,nfgv,info,ifun,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;     +                 iword,nfree,nact,ileave,nenter</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="keywordtype">double precision</span> theta,fold,ddot,dr,rr,tol,</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;     +                 xstep,sbgnrm,ddum,dnorm,dtd,epsmch,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;     +                 cpu1,cpu2,cachyt,sbtime,lnscht,time1,time2,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;     +                 gd,gdold,stp,stpmx,time</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordtype">double precision</span> one,zero</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="keywordtype">parameter</span>        (one=1.0d0,zero=0.0d0)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">if</span> (task .eq. <span class="stringliteral">&#39;START&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;         epsmch = epsilon(one)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;         <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(time1)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">c        Initialize counters and scalars when task=&#39;START&#39;.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">c           for the limited memory BFGS matrices:</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;         col    = 0</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;         head   = 1</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;         theta  = one</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;         iupdat = 0</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;         updatd = .false.</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;         iback  = 0</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;         itail  = 0</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;         iword  = 0</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;         nact   = 0</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;         ileave = 0</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;         nenter = 0</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;         fold   = zero</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;         dnorm  = zero</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;         cpu1   = zero</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;         gd     = zero</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;         stpmx  = zero</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;         sbgnrm = zero</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;         stp    = zero</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;         gdold  = zero</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;         dtd    = zero</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">c           for operation counts:</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;         iter   = 0</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;         nfgv   = 0</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;         nseg   = 0</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;         nintol = 0</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;         nskip  = 0</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;         nfree  = n</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;         ifun   = 0</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">c           for stopping tolerance:</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;         tol = factr*epsmch</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">c           for measuring running time:</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;         cachyt = 0</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;         sbtime = 0</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;         lnscht = 0</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">c           &#39;word&#39; records the status of subspace solutions.</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;         word = <span class="stringliteral">&#39;---&#39;</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">c           &#39;info&#39; records the termination information.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;         info = 0</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;         itfile = 8</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;         <span class="keywordflow">if</span> (iprint .ge. 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">c                                open a summary file &#39;iterate.dat&#39;</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keyword">open</span> (itfile, file = <span class="stringliteral">&#39;iterate.dat&#39;</span>, status = <span class="stringliteral">&#39;unknown&#39;</span>)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="keywordflow">         endif</span>            </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">c        Check the input arguments for errors.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;         <span class="keyword">call </span><a class="code" href="errclb_8f.html#affdf5cf80f86556653ba2cc860a2bb32">errclb</a>(n,m,factr,l,u,nbd,task,info,k)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;         <span class="keywordflow">if</span> (task(1:5) .eq. <span class="stringliteral">&#39;ERROR&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keyword">call </span><a class="code" href="prn3lb_8f.html#a433c19f6cb8b79a552a65371fecffb8c">prn3lb</a>(n,x,f,task,iprint,info,itfile,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;     +                  iter,nfgv,nintol,nskip,nact,sbgnrm,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;     +                  zero,nseg,word,iback,stp,xstep,k,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;     +                  cachyt,sbtime,lnscht)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;         <span class="keyword">call </span><a class="code" href="prn1lb_8f.html#a9d5d96d3efd3ea19322ee8d472954cc9">prn1lb</a>(n,m,l,u,x,iprint,itfile,epsmch)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">c        Initialize iwhere &amp; project x onto the feasible set.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;         <span class="keyword">call </span><a class="code" href="active_8f.html#aabce91f1253de53e2bae52ad9b94fcbb">active</a>(n,l,u,nbd,x,iwhere,iprint,prjctd,cnstnd,boxed) </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">c        The end of the initialization.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">c          restore local variables.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;         prjctd = lsave(1)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;         cnstnd = lsave(2)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;         boxed  = lsave(3)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;         updatd = lsave(4)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;         nintol = isave(1)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;         itfile = isave(3)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;         iback  = isave(4)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;         nskip  = isave(5)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;         head   = isave(6)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;         col    = isave(7)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;         itail  = isave(8)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;         iter   = isave(9)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;         iupdat = isave(10)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;         nseg   = isave(12)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;         nfgv   = isave(13)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;         info   = isave(14)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;         ifun   = isave(15)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;         iword  = isave(16)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;         nfree  = isave(17)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         nact   = isave(18)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;         ileave = isave(19)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;         nenter = isave(20)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         theta  = dsave(1)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;         fold   = dsave(2)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;         tol    = dsave(3)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;         dnorm  = dsave(4)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         epsmch = dsave(5)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;         cpu1   = dsave(6)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;         cachyt = dsave(7)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         sbtime = dsave(8)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         lnscht = dsave(9)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;         time1  = dsave(10)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;         gd     = dsave(11)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;         stpmx  = dsave(12)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;         sbgnrm = dsave(13)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;         stp    = dsave(14)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         gdold  = dsave(15)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;         dtd    = dsave(16)</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">c        After returning from the driver go to the point where execution</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">c        is to resume.</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;         <span class="keywordflow">if</span> (task(1:5) .eq. <span class="stringliteral">&#39;FG_LN&#39;</span>) <span class="keywordflow">goto</span> 666</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         <span class="keywordflow">if</span> (task(1:5) .eq. <span class="stringliteral">&#39;NEW_X&#39;</span>) <span class="keywordflow">goto</span> 777</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;         <span class="keywordflow">if</span> (task(1:5) .eq. <span class="stringliteral">&#39;FG_ST&#39;</span>) <span class="keywordflow">goto</span> 111</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;         <span class="keywordflow">if</span> (task(1:4) .eq. <span class="stringliteral">&#39;STOP&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">if</span> (task(7:9) .eq. <span class="stringliteral">&#39;CPU&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">c                                          restore the previous iterate.</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;               <span class="keyword">call </span>dcopy(n,t,1,x,1)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;               <span class="keyword">call </span>dcopy(n,r,1,g,1)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;               f = fold</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">goto</span> 999</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="keywordflow">      endif</span> </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">c     Compute f0 and g0.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      task = <span class="stringliteral">&#39;FG_START&#39;</span> </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">c          return to the driver to calculate f and g; reenter at 111.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">goto</span> 1000</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; 111  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      nfgv = 1</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">c     Compute the infinity norm of the (-) projected gradient.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keyword">call </span><a class="code" href="projgr_8f.html#a7c7b868c8b42f51efd25e48cd293cb5f">projgr</a>(n,l,u,nbd,x,g,sbgnrm)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">if</span> (iprint .ge. 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;         <span class="keyword">write</span> (6,1002) iter,f,sbgnrm</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;         <span class="keyword">write</span> (itfile,1003) iter,nfgv,sbgnrm,f</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keywordflow">if</span> (sbgnrm .le. pgtol) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">c                                terminate the algorithm.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;         task = <span class="stringliteral">&#39;CONVERGENCE: NORM_OF_PROJECTED_GRADIENT_&lt;=_PGTOL&#39;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;         <span class="keywordflow">goto</span> 999</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordflow">      endif</span> </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">c ----------------- the beginning of the loop --------------------------</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; 222  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">if</span> (iprint .ge. 99) <span class="keyword">write</span> (6,1001) iter + 1</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      iword = -1</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">if</span> (.not. cnstnd .and. col .gt. 0) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">c                                            skip the search for GCP.</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;         <span class="keyword">call </span>dcopy(n,x,1,z,1)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;         wrk = updatd</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;         nseg = 0</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;         <span class="keywordflow">goto</span> 333</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">c     Compute the Generalized Cauchy Point (GCP).</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu1) </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keyword">call </span><a class="code" href="cauchy_8f.html#ade50ac4208f509bdc3d04a325285a8be">cauchy</a>(n,x,l,u,nbd,g,indx2,iwhere,t,d,z,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;     +            m,wy,ws,sy,wt,theta,col,head,</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;     +            wa(1),wa(2*m+1),wa(4*m+1),wa(6*m+1),nseg,</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;     +            iprint, sbgnrm, info, epsmch)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">if</span> (info .ne. 0) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">c         singular triangular system detected; refresh the lbfgs memory.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;         <span class="keywordflow">if</span>(iprint .ge. 1) <span class="keyword">write</span> (6, 1005)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;         info   = 0</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;         col    = 0</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;         head   = 1</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;         theta  = one</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;         iupdat = 0</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;         updatd = .false.</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu2) </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         cachyt = cachyt + cpu2 - cpu1</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;         <span class="keywordflow">goto</span> 222</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu2) </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      cachyt = cachyt + cpu2 - cpu1</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      nintol = nintol + nseg</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">c     Count the entering and leaving variables for iter &gt; 0; </span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">c     find the index set of free and active variables at the GCP.</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keyword">call </span><a class="code" href="freev_8f.html#a9e31e2bbd26db0eabd2e72c99e5a2f84">freev</a>(n,nfree,index,nenter,ileave,indx2,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;     +           iwhere,wrk,updatd,cnstnd,iprint,iter)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      nact = n - nfree</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; 333  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">c     If there are no free variables or B=theta*I, then</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">c                                        skip the subspace minimization.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keywordflow">if</span> (nfree .eq. 0 .or. col .eq. 0) <span class="keywordflow">goto</span> 555</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">c     Subspace minimization.</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu1) </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">c     Form  the LEL^T factorization of the indefinite</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">c       matrix    K = [-D -Y&#39;ZZ&#39;Y/theta     L_a&#39;-R_z&#39;  ]</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">c                     [L_a -R_z           theta*S&#39;AA&#39;S ]</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">c       where     E = [-I  0]</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">c                     [ 0  I]</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordflow">if</span> (wrk) <span class="keyword">call </span><a class="code" href="formk_8f.html#a0e64ef7f777edb20419c8d441107c654">formk</a>(n,nfree,index,nenter,ileave,indx2,iupdat,</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;     +                 updatd,wn,snd,m,ws,wy,sy,theta,col,head,info)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">if</span> (info .ne. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">c          nonpositive definiteness in Cholesky factorization;</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">c          refresh the lbfgs memory and restart the iteration.</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;         <span class="keywordflow">if</span>(iprint .ge. 1) <span class="keyword">write</span> (6, 1006)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;         info   = 0</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;         col    = 0</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;         head   = 1</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;         theta  = one</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;         iupdat = 0</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;         updatd = .false.</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;         <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu2) </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;         sbtime = sbtime + cpu2 - cpu1 </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;         <span class="keywordflow">goto</span> 222</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordflow">      endif</span> </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">c        compute r=-Z&#39;B(xcp-xk)-Z&#39;g (using wa(2m+1)=W&#39;(xcp-x)</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">c                                                   from &#39;cauchy&#39;).</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keyword">call </span><a class="code" href="cmprlb_8f.html#aeca70b38353e4c44297fef717a66def4">cmprlb</a>(n,m,x,g,ws,wy,sy,wt,z,r,wa,index,</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;     +           theta,col,head,nfree,cnstnd,info)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">if</span> (info .ne. 0) <span class="keywordflow">goto</span> 444</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">c-jlm-jn   call the direct method. </span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keyword">call </span><a class="code" href="subsm_8f.html#a885224f17c93707dec22de0a51a4081d">subsm</a>( n, m, nfree, index, l, u, nbd, z, r, xp, ws, wy,</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;     +           theta, x, g, col, head, iword, wa, wn, iprint, info)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; 444  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordflow">if</span> (info .ne. 0) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">c          singular triangular system detected;</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">c          refresh the lbfgs memory and restart the iteration.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;         <span class="keywordflow">if</span>(iprint .ge. 1) <span class="keyword">write</span> (6, 1005)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;         info   = 0</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;         col    = 0</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;         head   = 1</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;         theta  = one</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;         iupdat = 0</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;         updatd = .false.</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;         <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu2) </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;         sbtime = sbtime + cpu2 - cpu1 </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;         <span class="keywordflow">goto</span> 222</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu2) </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      sbtime = sbtime + cpu2 - cpu1 </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; 555  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">c     Line search and optimality tests.</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">c     Generate the search direction d:=z-x.</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="keywordflow">do</span> 40 i = 1, n</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;         d(i) = z(i) - x(i)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  40  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu1) </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; 666  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keyword">call </span><a class="code" href="lnsrlb_8f.html#a1ae769fcc1d4f0f54e793a730e879dbc">lnsrlb</a>(n,l,u,nbd,x,f,fold,gd,gdold,g,d,r,t,z,stp,dnorm,</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;     +            dtd,xstep,stpmx,iter,ifun,iback,nfgv,info,task,</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;     +            boxed,cnstnd,csave,isave(22),dsave(17))</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordflow">if</span> (info .ne. 0 .or. iback .ge. 20) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">c          restore the previous iterate.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;         <span class="keyword">call </span>dcopy(n,t,1,x,1)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;         <span class="keyword">call </span>dcopy(n,r,1,g,1)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;         f = fold</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;         <span class="keywordflow">if</span> (col .eq. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">c             abnormal termination.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">if</span> (info .eq. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;               info = -9</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">c                restore the actual number of f and g evaluations etc.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;               nfgv = nfgv - 1</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;               ifun = ifun - 1</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;               iback = iback - 1</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            task = <span class="stringliteral">&#39;ABNORMAL_TERMINATION_IN_LNSRCH&#39;</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            iter = iter + 1</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">goto</span> 999</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">c             refresh the lbfgs memory and restart the iteration.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keywordflow">if</span>(iprint .ge. 1) <span class="keyword">write</span> (6, 1008)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="keywordflow">if</span> (info .eq. 0) nfgv = nfgv - 1</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            info   = 0</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            col    = 0</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            head   = 1</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            theta  = one</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            iupdat = 0</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            updatd = .false.</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            task   = <span class="stringliteral">&#39;RESTART_FROM_LNSRCH&#39;</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu2)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            lnscht = lnscht + cpu2 - cpu1</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="keywordflow">goto</span> 222</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (task(1:5) .eq. <span class="stringliteral">&#39;FG_LN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">c          return to the driver for calculating f and g; reenter at 666.</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;         <span class="keywordflow">goto</span> 1000</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">c          calculate and print out the quantities related to the new X.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;         <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(cpu2) </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;         lnscht = lnscht + cpu2 - cpu1</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;         iter = iter + 1</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">c        Compute the infinity norm of the projected (-)gradient.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;         <span class="keyword">call </span><a class="code" href="projgr_8f.html#a7c7b868c8b42f51efd25e48cd293cb5f">projgr</a>(n,l,u,nbd,x,g,sbgnrm)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">c        Print iteration information.</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;         <span class="keyword">call </span><a class="code" href="prn2lb_8f.html#a5df5a6f8f26c5a5a68585b45a41032bd">prn2lb</a>(n,x,f,g,iprint,itfile,iter,nfgv,nact,</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;     +               sbgnrm,nseg,word,iword,iback,stp,xstep)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;         <span class="keywordflow">goto</span> 1000</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; 777  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">c     Test for termination.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">if</span> (sbgnrm .le. pgtol) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">c                                terminate the algorithm.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;         task = <span class="stringliteral">&#39;CONVERGENCE: NORM_OF_PROJECTED_GRADIENT_&lt;=_PGTOL&#39;</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         <span class="keywordflow">goto</span> 999</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keywordflow">      endif</span> </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      ddum = max(abs(fold), abs(f), one)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">if</span> ((fold - f) .le. tol*ddum) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">c                                        terminate the algorithm.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         task = <span class="stringliteral">&#39;CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH&#39;</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;         <span class="keywordflow">if</span> (iback .ge. 10) info = -5</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">c           i.e., to issue a warning if iback&gt;10 in the line search.</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;         <span class="keywordflow">goto</span> 999</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordflow">      endif</span> </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">c     Compute d=newx-oldx, r=newg-oldg, rr=y&#39;y and dr=y&#39;s.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">do</span> 42 i = 1, n</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;         r(i) = g(i) - r(i)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  42  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      rr = ddot(n,r,1,r,1)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">if</span> (stp .eq. one) <span class="keywordflow">then</span>  </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;         dr = gd - gdold</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;         ddum = -gdold</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         dr = (gd - gdold)*stp</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;         <span class="keyword">call </span>dscal(n,stp,d,1)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;         ddum = -gdold*stp</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keywordflow">if</span> (dr .le. epsmch*ddum) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">c                            skip the L-BFGS update.</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;         nskip = nskip + 1</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;         updatd = .false.</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;         <span class="keywordflow">if</span> (iprint .ge. 1) <span class="keyword">write</span> (6,1004) dr, ddum</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;         <span class="keywordflow">goto</span> 888</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="keywordflow">      endif</span> </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">c     Update the L-BFGS matrix.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">c</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      updatd = .true.</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      iupdat = iupdat + 1</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">c     Update matrices WS and WY and form the middle matrix in B.</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keyword">call </span><a class="code" href="matupd_8f.html#ae0d8b7b11bf7546ed4d53b433273f74b">matupd</a>(n,m,ws,wy,sy,ss,d,r,itail,</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;     +            iupdat,col,head,theta,rr,dr,stp,dtd)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">c     Form the upper half of the pds T = theta*SS + L*D^(-1)*L&#39;;</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">c        Store T in the upper triangular of the array wt;</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">c        Cholesky factorize T to J*J&#39; with</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">c           J&#39; stored in the upper triangular of wt.</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keyword">call </span><a class="code" href="formt_8f.html#a237bf34b63889556b05399c224ec5f71">formt</a>(m,wt,sy,ss,col,theta,info)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keywordflow">if</span> (info .ne. 0) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">c          nonpositive definiteness in Cholesky factorization;</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">c          refresh the lbfgs memory and restart the iteration.</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;         <span class="keywordflow">if</span>(iprint .ge. 1) <span class="keyword">write</span> (6, 1007)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;         info = 0</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;         col = 0</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;         head = 1</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;         theta = one</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;         iupdat = 0</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;         updatd = .false.</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;         <span class="keywordflow">goto</span> 222</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">c     Now the inverse of the middle matrix in B is</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">c       [  D^(1/2)      O ] [ -D^(1/2)  D^(-1/2)*L&#39; ]</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">c       [ -L*D^(-1/2)   J ] [  0        J&#39;          ]</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; 888  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">c -------------------- the end of the loop -----------------------------</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keywordflow">goto</span> 222</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; 999  <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keyword">call </span><a class="code" href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a>(time2)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      time = time2 - time1</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keyword">call </span><a class="code" href="prn3lb_8f.html#a433c19f6cb8b79a552a65371fecffb8c">prn3lb</a>(n,x,f,task,iprint,info,itfile,</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;     +            iter,nfgv,nintol,nskip,nact,sbgnrm,</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;     +            time,nseg,word,iback,stp,xstep,k,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;     +            cachyt,sbtime,lnscht)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; 1000 <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">c     Save local variables.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      lsave(1)  = prjctd</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      lsave(2)  = cnstnd</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      lsave(3)  = boxed</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      lsave(4)  = updatd</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      isave(1)  = nintol </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      isave(3)  = itfile </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      isave(4)  = iback </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      isave(5)  = nskip </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      isave(6)  = head </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      isave(7)  = col </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      isave(8)  = itail </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      isave(9)  = iter </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      isave(10) = iupdat </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      isave(12) = nseg</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      isave(13) = nfgv </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      isave(14) = info </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      isave(15) = ifun </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      isave(16) = iword </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      isave(17) = nfree </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      isave(18) = nact </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      isave(19) = ileave </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      isave(20) = nenter </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      dsave(1)  = theta </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      dsave(2)  = fold </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      dsave(3)  = tol </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      dsave(4)  = dnorm </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      dsave(5)  = epsmch </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      dsave(6)  = cpu1 </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      dsave(7)  = cachyt </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      dsave(8)  = sbtime </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      dsave(9)  = lnscht </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      dsave(10) = time1 </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      dsave(11) = gd </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      dsave(12) = stpmx </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      dsave(13) = sbgnrm</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      dsave(14) = stp</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      dsave(15) = gdold</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      dsave(16) = dtd  </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; 1001 <span class="keyword">format</span> (//,<span class="stringliteral">&#39;ITERATION &#39;</span>,i5)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; 1002 <span class="keyword">format</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;     +  (/,<span class="stringliteral">&#39;At iterate&#39;</span>,i5,4x,<span class="stringliteral">&#39;f= &#39;</span>,1p,d12.5,4x,<span class="stringliteral">&#39;|proj g|= &#39;</span>,1p,d12.5)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; 1003 <span class="keyword">format</span> (2(1x,i4),5x,<span class="stringliteral">&#39;-&#39;</span>,5x,<span class="stringliteral">&#39;-&#39;</span>,3x,<span class="stringliteral">&#39;-&#39;</span>,5x,<span class="stringliteral">&#39;-&#39;</span>,5x,<span class="stringliteral">&#39;-&#39;</span>,8x,<span class="stringliteral">&#39;-&#39;</span>,3x,</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;     +        1p,2(1x,d10.3))</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; 1004 <span class="keyword">format</span> (<span class="stringliteral">&#39;  ys=&#39;</span>,1p,e10.3,<span class="stringliteral">&#39;  -gs=&#39;</span>,1p,e10.3,<span class="stringliteral">&#39; BFGS update SKIPPED&#39;</span>)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; 1005 <span class="keyword">format</span> (/, </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;     +<span class="stringliteral">&#39; Singular triangular system detected;&#39;</span>,/,</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;     +<span class="stringliteral">&#39;   refresh the lbfgs memory and restart the iteration.&#39;</span>)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; 1006 <span class="keyword">format</span> (/, </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;     +<span class="stringliteral">&#39; Nonpositive definiteness in Cholesky factorization in formk;&#39;</span>,/,</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;     +<span class="stringliteral">&#39;   refresh the lbfgs memory and restart the iteration.&#39;</span>)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; 1007 <span class="keyword">format</span> (/, </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;     +<span class="stringliteral">&#39; Nonpositive definiteness in Cholesky factorization in formt;&#39;</span>,/,</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;     +<span class="stringliteral">&#39;   refresh the lbfgs memory and restart the iteration.&#39;</span>)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; 1008 <span class="keyword">format</span> (/, </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;     +<span class="stringliteral">&#39; Bad direction in the line search;&#39;</span>,/,</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;     +<span class="stringliteral">&#39;   refresh the lbfgs memory and restart the iteration.&#39;</span>)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">return</span>   </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keyword">end</span></div>
<div class="ttc" id="aactive_8f_html_aabce91f1253de53e2bae52ad9b94fcbb"><div class="ttname"><a href="active_8f.html#aabce91f1253de53e2bae52ad9b94fcbb">active</a></div><div class="ttdeci">subroutine active(n, l, u, nbd, x, iwhere, iprint, prjctd, cnstnd, boxed)</div><div class="ttdoc">This subroutine initializes iwhere and projects the initial x to the feasible set if necessary.</div><div class="ttdef"><b>Definition:</b> <a href="active_8f_source.html#l00032">active.f:34</a></div></div>
<div class="ttc" id="acauchy_8f_html_ade50ac4208f509bdc3d04a325285a8be"><div class="ttname"><a href="cauchy_8f.html#ade50ac4208f509bdc3d04a325285a8be">cauchy</a></div><div class="ttdeci">subroutine cauchy(n, x, l, u, nbd, g, iorder, iwhere, t, d, xcp, m, wy, ws, sy, wt, theta, col, head, p, c, wbp, v, nseg, iprint, sbgnrm, info, epsmch)</div><div class="ttdoc">Compute the Generalized Cauchy Point along the projected gradient direction.</div><div class="ttdef"><b>Definition:</b> <a href="cauchy_8f_source.html#l00130">cauchy.f:133</a></div></div>
<div class="ttc" id="acmprlb_8f_html_aeca70b38353e4c44297fef717a66def4"><div class="ttname"><a href="cmprlb_8f.html#aeca70b38353e4c44297fef717a66def4">cmprlb</a></div><div class="ttdeci">subroutine cmprlb(n, m, x, g, ws, wy, sy, wt, z, r, wa, index, theta, col, head, nfree, cnstnd, info)</div><div class="ttdoc">This subroutine computes r=-Z'B(xcp-xk)-Z'g by using wa(2m+1)=W'(xcp-x) from subroutine cauchy.</div><div class="ttdef"><b>Definition:</b> <a href="cmprlb_8f_source.html#l00027">cmprlb.f:29</a></div></div>
<div class="ttc" id="aerrclb_8f_html_affdf5cf80f86556653ba2cc860a2bb32"><div class="ttname"><a href="errclb_8f.html#affdf5cf80f86556653ba2cc860a2bb32">errclb</a></div><div class="ttdeci">subroutine errclb(n, m, factr, l, u, nbd, task, info, k)</div><div class="ttdoc">This subroutine checks the validity of the input data.</div><div class="ttdef"><b>Definition:</b> <a href="errclb_8f_source.html#l00016">errclb.f:17</a></div></div>
<div class="ttc" id="aformk_8f_html_a0e64ef7f777edb20419c8d441107c654"><div class="ttname"><a href="formk_8f.html#a0e64ef7f777edb20419c8d441107c654">formk</a></div><div class="ttdeci">subroutine formk(n, nsub, ind, nenter, ileave, indx2, iupdat, updatd, wn, wn1, m, ws, wy, sy, theta, col, head, info)</div><div class="ttdoc">Forms the LEL^T factorization of the indefinite matrix K.</div><div class="ttdef"><b>Definition:</b> <a href="formk_8f_source.html#l00089">formk.f:92</a></div></div>
<div class="ttc" id="aformt_8f_html_a237bf34b63889556b05399c224ec5f71"><div class="ttname"><a href="formt_8f.html#a237bf34b63889556b05399c224ec5f71">formt</a></div><div class="ttdeci">subroutine formt(m, wt, sy, ss, col, theta, info)</div><div class="ttdoc">Forms the upper half of the pos. def. and symm. T.</div><div class="ttdef"><b>Definition:</b> <a href="formt_8f_source.html#l00021">formt.f:22</a></div></div>
<div class="ttc" id="afreev_8f_html_a9e31e2bbd26db0eabd2e72c99e5a2f84"><div class="ttname"><a href="freev_8f.html#a9e31e2bbd26db0eabd2e72c99e5a2f84">freev</a></div><div class="ttdeci">subroutine freev(n, nfree, index, nenter, ileave, indx2, iwhere, wrk, updatd, cnstnd, iprint, iter)</div><div class="ttdoc">This subroutine counts the entering and leaving variables when iter &gt; 0, and finds the index set of f...</div><div class="ttdef"><b>Definition:</b> <a href="freev_8f_source.html#l00032">freev.f:34</a></div></div>
<div class="ttc" id="alnsrlb_8f_html_a1ae769fcc1d4f0f54e793a730e879dbc"><div class="ttname"><a href="lnsrlb_8f.html#a1ae769fcc1d4f0f54e793a730e879dbc">lnsrlb</a></div><div class="ttdeci">subroutine lnsrlb(n, l, u, nbd, x, f, fold, gd, gdold, g, d, r, t, z, stp, dnorm, dtd, xstep, stpmx, iter, ifun, iback, nfgv, info, task, boxed, cnstnd, csave, isave, dsave)</div><div class="ttdoc">This subroutine calls subroutine dcsrch from the Minpack2 library to perform the line search....</div><div class="ttdef"><b>Definition:</b> <a href="lnsrlb_8f_source.html#l00043">lnsrlb.f:47</a></div></div>
<div class="ttc" id="amainlb_8f_html_a5a0132dc055b1aade2710adfff9b8f09"><div class="ttname"><a href="mainlb_8f.html#a5a0132dc055b1aade2710adfff9b8f09">mainlb</a></div><div class="ttdeci">subroutine mainlb(n, m, x, l, u, nbd, f, g, factr, pgtol, ws, wy, sy, ss, wt, wn, snd, z, r, d, t, xp, wa, index, iwhere, indx2, task, iprint, csave, lsave, isave, dsave)</div><div class="ttdoc">This subroutine solves bound constrained optimization problems by using the compact formula of the li...</div><div class="ttdef"><b>Definition:</b> <a href="mainlb_8f_source.html#l00128">mainlb.f:132</a></div></div>
<div class="ttc" id="amatupd_8f_html_ae0d8b7b11bf7546ed4d53b433273f74b"><div class="ttname"><a href="matupd_8f.html#ae0d8b7b11bf7546ed4d53b433273f74b">matupd</a></div><div class="ttdeci">subroutine matupd(n, m, ws, wy, sy, ss, d, r, itail, iupdat, col, head, theta, rr, dr, stp, dtd)</div><div class="ttdoc">This subroutine updates matrices WS and WY, and forms the middle matrix in B.</div><div class="ttdef"><b>Definition:</b> <a href="matupd_8f_source.html#l00049">matupd.f:51</a></div></div>
<div class="ttc" id="aprn1lb_8f_html_a9d5d96d3efd3ea19322ee8d472954cc9"><div class="ttname"><a href="prn1lb_8f.html#a9d5d96d3efd3ea19322ee8d472954cc9">prn1lb</a></div><div class="ttdeci">subroutine prn1lb(n, m, l, u, x, iprint, itfile, epsmch)</div><div class="ttdoc">This subroutine prints the input data, initial point, upper and lower bounds of each variable,...</div><div class="ttdef"><b>Definition:</b> <a href="prn1lb_8f_source.html#l00039">prn1lb.f:40</a></div></div>
<div class="ttc" id="aprn2lb_8f_html_a5df5a6f8f26c5a5a68585b45a41032bd"><div class="ttname"><a href="prn2lb_8f.html#a5df5a6f8f26c5a5a68585b45a41032bd">prn2lb</a></div><div class="ttdeci">subroutine prn2lb(n, x, f, g, iprint, itfile, iter, nfgv, nact, sbgnrm, nseg, word, iword, iback, stp, xstep)</div><div class="ttdoc">This subroutine prints out new information after a successful line search.</div><div class="ttdef"><b>Definition:</b> <a href="prn2lb_8f_source.html#l00043">prn2lb.f:45</a></div></div>
<div class="ttc" id="aprn3lb_8f_html_a433c19f6cb8b79a552a65371fecffb8c"><div class="ttname"><a href="prn3lb_8f.html#a433c19f6cb8b79a552a65371fecffb8c">prn3lb</a></div><div class="ttdeci">subroutine prn3lb(n, x, f, task, iprint, info, itfile, iter, nfgv, nintol, nskip, nact, sbgnrm, time, nseg, word, iback, stp, xstep, k, cachyt, sbtime, lnscht)</div><div class="ttdoc">This subroutine prints out information when either a built-in convergence test is satisfied or when a...</div><div class="ttdef"><b>Definition:</b> <a href="prn3lb_8f_source.html#l00041">prn3lb.f:45</a></div></div>
<div class="ttc" id="aprojgr_8f_html_a7c7b868c8b42f51efd25e48cd293cb5f"><div class="ttname"><a href="projgr_8f.html#a7c7b868c8b42f51efd25e48cd293cb5f">projgr</a></div><div class="ttdeci">subroutine projgr(n, l, u, nbd, x, g, sbgnrm)</div><div class="ttdoc">This subroutine computes the infinity norm of the projected gradient.</div><div class="ttdef"><b>Definition:</b> <a href="projgr_8f_source.html#l00033">projgr.f:34</a></div></div>
<div class="ttc" id="asubsm_8f_html_a885224f17c93707dec22de0a51a4081d"><div class="ttname"><a href="subsm_8f.html#a885224f17c93707dec22de0a51a4081d">subsm</a></div><div class="ttdeci">subroutine subsm(n, m, nsub, ind, l, u, nbd, x, d, xp, ws, wy, theta, xx, gg, col, head, iword, wv, wn, iprint, info)</div><div class="ttdoc">Performs the subspace minimization.</div><div class="ttdef"><b>Definition:</b> <a href="subsm_8f_source.html#l00124">subsm.f:127</a></div></div>
<div class="ttc" id="atimer_8f_html_ab582fd1ba3cb021020eb67c22b03d118"><div class="ttname"><a href="timer_8f.html#ab582fd1ba3cb021020eb67c22b03d118">timer</a></div><div class="ttdeci">subroutine timer(ttime)</div><div class="ttdoc">This routine computes cpu time in double precision.</div><div class="ttdef"><b>Definition:</b> <a href="timer_8f_source.html#l00010">timer.f:11</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="mainlb_8f.html">mainlb.f</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
